# -*- coding: utf-8 -*-
"""pythr.py: Visual modeling helper."""

__author__ = "Bac9l Xyer"
__copyright__ = "GPLv3"

import abc


class Entity_manager():

    entity_list = []
    camera_list = []
    light_list = []

    def entity_list_append(self, entity_class) -> None:
        self.entity_list.append(entity_class)

    def clear_entity_list(self) -> None:
        for i in self.entity_list: del i
        self.entity_list.clear()

    @property
    def get_entity_list(self) -> list:
        return self.entity_list

    def camera_list_append(self, entity_class) -> None:
        self.entity_list.append(entity_class)

    def clear_camera_list(self) -> None:
        for i in self.entity_list: del i
        self.entity_list.clear()

    @property
    def get_camera_list(self) -> list:
        return self.entity_list

    def light_list_append(self, entity_class) -> None:
        self.entity_list.append(entity_class)

    def clear_light_list(self) -> None:
        for i in self.entity_list: del i
        self.entity_list.clear()

    @property
    def get_light_list(self) -> list:
        return self.entity_list


class Entity(abc.ABC, Entity_manager):
    manager = Entity_manager()

    @abc.abstractmethod
    def return_dict(self):
        pass

    @property
    def get_name(self):
        entity_number = self.manager.get_entity_list.index(self)
        return ''.join(('Object', str(entity_number)))


class Box(Entity):
    def __init__(
            self,
            width: float,
            height: float,
            depth: float,
            color:int = 0xffffff,
            texture = None,
            position: dict = {'x': 0, 'y': 0, 'z': 0}, 
            rotation: dict = {'x': 0, 'y': 0, 'z': 0},
            material_type: str = 'MeshBasicMaterial',
            cast_shadow = True,
            receive_shadow = True
            ) -> None:
        self.entity_list_append(self)
        self.geometry_type = 'BoxGeometry'
        self.geometry = {
                'width': width,
                'height': height,
                'depth': depth
                } 
        self.position = position
        self.rotation = rotation
        self.material = {'texture': texture} if texture else {'color': color}
        self.material_type = material_type
        self.cast_shadow = cast_shadow
        self.receive_shadow = receive_shadow

    def return_dict(self) -> dict:
        entity_dict = {
                'material_type': self.material_type,
                'geometry_type': self.geometry_type,
                'geometry': self.geometry,
                'material': self.material,
                'position': self.position,
                'rotation': self.rotation,
                'castShadow': self.cast_shadow,
                'receiveShadow': self.receive_shadow

                }
        return entity_dict


class Sphere(Entity):
    def __init__(
            self,
            radius: float,
            widthSegments: float,
            heightSegments: float,
            color:int = 0xffffff,
            texture = None,
            position: dict = {'x': 0, 'y': 0, 'z': 0}, 
            rotation: dict = {'x': 0, 'y': 0, 'z': 0},
            material_type: str = 'MeshStandardMaterial',
            cast_shadow = True,
            receive_shadow = True
            ) -> None:
        self.entity_list_append(self)
        self.geometry_type = 'SphereGeometry'
        self.geometry = {
                'radius': radius,
                'widthSegments': widthSegments,
                'heightSegments': heightSegments
                } 
        self.position = position
        self.rotation = rotation
        self.material = {'texture': texture} if texture else {'color': color}
        self.material_type = material_type
        self.cast_shadow = cast_shadow
        self.receive_shadow = receive_shadow

    def return_dict(self) -> dict:
        entity_dict = {
                'material_type': self.material_type,
                'geometry_type': self.geometry_type,
                'geometry': self.geometry,
                'material': self.material,
                'position': self.position,
                'rotation': self.rotation,
                'castShadow': self.cast_shadow,
                'receiveShadow': self.receive_shadow

                }
        return entity_dict


class Plane(Entity):
    def __init__(
            self,
            width: float,
            height: float,
            color:int = 0xffffff,
            texture = None,
            position: dict = {'x': 0, 'y': 0, 'z': 0}, 
            rotation: dict = {'x': 0, 'y': 0, 'z': 0},
            material_type: str = 'MeshStandardMaterial',
            cast_shadow = False,
            receive_shadow = True
            ) -> None:
        self.entity_list_append(self)
        self.geometry_type = 'PlaneGeometry'
        self.geometry = {
                'width': width,
                'height': height
                } 
        self.position = position
        self.rotation = rotation
        self.material = {'texture': texture} if texture else {'color': color}
        self.material_type = material_type
        self.cast_shadow = cast_shadow
        self.receive_shadow = receive_shadow


    def return_dict(self) -> dict:
        entity_dict = {
                'material_type': self.material_type,
                'geometry_type': self.geometry_type,
                'geometry': self.geometry,
                'material': self.material,
                'position': self.position,
                'rotation': self.rotation,
                'castShadow': self.cast_shadow,
                'receiveShadow': self.receive_shadow
                }
        return entity_dict


class Camera(Entity):
    def __init__(
            self, 
            camera_type: str='PerspectiveCamera', 
            fild_of_view: int=75, 
            aspect_ratio: str='innerWidth / innerHeight',
            clipping_plane_near: float=0.1,
            clipping_plane_far: float=1000,
            position: dict={'x': -40, 'y': 40, 'z': 40}
            ) -> None:
        self.camera_type = camera_type
        self.fild_of_view = fild_of_view
        self.aspect_ratio = aspect_ratio
        self.clipping_plane_near = clipping_plane_near
        self.clipping_plane_far = clipping_plane_far
        self.position = position

    def return_dict(self) -> dict:
        return self.__dict__


class Light(Entity):
    def __init__(
            self, 
            light_type: str='DirectionalLight',
            color: int=0xffffff,
            intensity: float=1.0,
            shadow: dict={
                'bias': -0.001,
                'map_size_width': 2048,
                'map_size_height': 2048,
                'camere_near': 0.5,
                'camera_far': 500,
                'camera_left': 100,
                'camera_right': -100,
                'camera_top': 100,
                'camera_bottom': -100
                },
            target_position: dict={'x': 20, 'y': 100, 'z': 10},
            position: dict={'x': 20, 'y': 100, 'z': 10},
            cast_shadow = True,
            ) -> None:
        self.color = color
        self.intensity = intensity
        self.light_type = light_type
        self.shadow = shadow
        self.target_position = target_position
        self.position = position
        self.cast_shadow = cast_shadow

    def return_dict(self) -> dict:
        return self.__dict__


class Entity_fabric:
    @staticmethod
    def create(entity_type, *args, **kwargs):
        if entity_type == 'box':
            entity = Box(*args, **kwargs)
        elif entity_type == 'sphere':
            entity = Sphere(*args, **kwargs)
        elif entity_type == 'plane':
            entity = Plane(*args, **kwargs)
        elif entity_type == 'camera':
            entity = Camera(*args, **kwargs)
        else:
            entity = Box(*args, **kwargs)

        return entity


class Light_fabric:
    @staticmethod
    def create(entity_type, *args, **kwargs):
        if entity_type == 'box':
            entity = Box(*args, **kwargs)
        elif entity_type == 'sphere':
            entity = Sphere(*args, **kwargs)
        elif entity_type == 'plane':
            entity = Plane(*args, **kwargs)
        elif entity_type == 'camera':
            entity = Camera(*args, **kwargs)
        else:
            entity = Box(*args, **kwargs)

        return entity
